<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Channels Dashboard V3</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒ™</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        
        /* Glassmorphism */
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.1); }
        .glass-light { background: rgba(51, 65, 85, 0.5); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08); }
        
        /* Gradients */
        .gradient-bg { background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%); }
        .gradient-primary { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); }
        .gradient-success { background: linear-gradient(135deg, #10b981 0%, #34d399 100%); }
        .gradient-warning { background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%); }
        .gradient-danger { background: linear-gradient(135deg, #ef4444 0%, #f87171 100%); }
        
        /* Inputs */
        input, select, textarea { background: rgba(30, 41, 59, 0.8) !important; color: #fff !important; border: 1px solid rgba(255,255,255,0.15) !important; transition: all 0.2s ease; }
        input:focus, select:focus, textarea:focus { outline: none !important; border-color: #6366f1 !important; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2) !important; }
        select option { background: #1e293b; color: #fff; }
        input::placeholder { color: #64748b !important; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: rgba(99, 102, 241, 0.4); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(99, 102, 241, 0.6); }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out; }
        .animate-pulse-slow { animation: pulse 2s infinite; }
        .animate-spin { animation: spin 1s linear infinite; }
        
        /* Tags */
        .tag-viral { background: linear-gradient(135deg, #ef4444, #f97316); }
        .tag-good { background: linear-gradient(135deg, #10b981, #34d399); }
        .tag-regular { background: linear-gradient(135deg, #f59e0b, #fbbf24); }
        .tag-flop { background: linear-gradient(135deg, #64748b, #94a3b8); }
        
        /* Sidebar */
        .sidebar { transition: all 0.3s ease; }
        .sidebar-collapsed { width: 70px; }
        .sidebar-expanded { width: 260px; }
        
        /* Mobile */
        @media (max-width: 768px) {
            .sidebar { position: fixed; z-index: 50; height: 100vh; }
            .sidebar-hidden { transform: translateX(-100%); }
            .sidebar-expanded { width: 260px; }
        }

        /* Period Buttons */
        .period-btn { transition: all 0.2s; }
        .period-btn.active { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ==================== CONFIGURAÃ‡Ã•ES ====================
        const SUPABASE_URL = 'https://gtshsppwbibihyrchtub.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0c2hzcHB3YmliaWh5cmNodHViIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1NDkyNzksImV4cCI6MjA3ODEyNTI3OX0.HnVzX1fvBhMg1Zqx0oRVqEVOgwxFd_2azyZJ-D8oOkY';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // ==================== PADRÃ•ES PRÃ‰-DEFINIDOS ====================
        const PATTERN_KEYWORDS = {
            'CEO + DivÃ³rcio + Child': ['ceo', 'divÃ³rcio', 'divorce', 'aÃ±os despuÃ©s', 'years later', 'hijo', 'son', 'daughter', 'hija', 'triplets', 'trillizos', 'twins', 'gemelos', 'firmÃ³', 'signed'],
            'RejeiÃ§Ã£o + Claim': ['rejected', 'rechazado', 'until', 'hasta que', 'claimed', 'nobody wanted', 'nadie querÃ­a', 'no one wanted', 'unwanted'],
            'Bondade Recompensada': ['compartiÃ³', 'shared', 'last meal', 'Ãºltima comida', 'homeless', 'sin hogar', 'turned out', 'resultÃ³ ser', 'billionaire', 'gave', 'dio'],
            'HeroÃ­smo': ['saved', 'salvÃ³', 'rescued', 'rescatÃ³', 'fire', 'incendio', 'drowning', 'ahogando', '12 people', '12 personas', 'hero'],
            'Child Reveal': ['llamÃ³', 'called', 'mommy', 'mamÃ¡', 'daddy', 'papÃ¡', 'front of', 'frente a', 'preguntÃ³', 'asked', 'son asked', 'preguntÃ³ su hijo'],
            'DNA Drama': ['dna', 'test', 'prueba', 'results', 'resultados', 'paternity', 'paternidad', 'not the father'],
            'VinganÃ§a Doce': ['years later', 'aÃ±os despuÃ©s', 'returned', 'regresÃ³', 'revenge', 'venganza', 'owns', 'dueÃ±o', 'humiliated', 'humillado'],
            'DiÃ¡logo Direto': ['"', '"', 'dijo', 'said', 'gritÃ³', 'shouted', 'you\'re not', 'no eres', '"no quiero"', '"i don\'t want"'],
            'Amor Proibido': ['forbidden', 'prohibido', 'secret', 'secreto', 'affair', 'maid', 'empleada', 'servant', 'boss'],
            'Natal': ['christmas', 'navidad', 'eve', 'nochebuena', 'santa', 'snow', 'nieve', 'holiday', 'airport'],
            'Mafia': ['mafia', 'mob', 'boss', 'jefe', 'don', 'capo', 'underworld', 'criminal', 'mafioso'],
            'Reencontro': ['years after', 'serving', 'sirviendo', 'waiter', 'mesero', 'table', 'mesa', 'ex'],
            'Identidade Secreta': ['didn\'t know', 'no sabÃ­a', 'secret identity', 'actually', 'en realidad', 'heir', 'heredero', 'sin saber'],
            'Gravidez': ['pregnant', 'embarazada', 'baby', 'bebÃ©', 'expecting', 'hid pregnancy', 'embarazo'],
            'Omega Desprezado': ['omega', 'weak', 'dÃ©bil', 'worthless', 'sin valor', 'powerful', 'poderoso', 'alpha']
        };

        const AVATAR_KEYWORDS = {
            'CEO/Alpha': ['ceo', 'alpha', 'alfa', 'boss', 'jefe', 'billionaire', 'millonario', 'president', 'presidente', 'gerente', 'manager'],
            'Omega': ['omega', 'weak omega', 'poor omega'],
            'Maid/Servant': ['maid', 'empleada', 'servant', 'sirviente', 'cleaner', 'limpiadora', 'waitress', 'mesera'],
            'Child/Baby': ['son', 'hijo', 'daughter', 'hija', 'baby', 'bebÃ©', 'triplets', 'trillizos', 'twins', 'niÃ±o', 'niÃ±a'],
            'Mafia Boss': ['mafia', 'don', 'mob boss', 'jefe mafioso', 'capo'],
            'Poor Person': ['poor', 'pobre', 'homeless', 'sin hogar', 'beggar', 'mendigo']
        };

        const TRIGGER_KEYWORDS = {
            'RejeiÃ§Ã£o': ['rejected', 'rechazado', 'abandoned', 'abandonado', 'left', 'dejÃ³', 'unwanted'],
            'HumilhaÃ§Ã£o': ['humiliated', 'humillado', 'mocked', 'burlado', 'laughed', 'riÃ³', 'despised'],
            'Time Jump': ['years later', 'aÃ±os despuÃ©s', '5 years', '5 aÃ±os', '10 years', '6 aÃ±os', '3 years'],
            'Identidade Oculta': ['didn\'t know', 'no sabÃ­a', 'turned out', 'resultÃ³', 'actually', 'sin saber'],
            'VinganÃ§a': ['revenge', 'venganza', 'payback', 'destroyed', 'destruyÃ³'],
            'CrianÃ§a': ['child', 'niÃ±o', 'son', 'hijo', 'daughter', 'baby', 'triplets'],
            'Gravidez': ['pregnant', 'embarazada', 'expecting', 'baby'],
            'DNA': ['dna', 'test', 'paternity', 'results'],
            'Karma': ['karma', 'destiny', 'destino', 'fate'],
            'HeroÃ­smo': ['saved', 'salvÃ³', 'rescued', 'hero']
        };

        // ==================== FUNÃ‡Ã•ES UTILITÃRIAS ====================
        function detectPattern(title) {
            const lowerTitle = title.toLowerCase();
            let bestMatch = null;
            let bestScore = 0;
            for (const [pattern, keywords] of Object.entries(PATTERN_KEYWORDS)) {
                let score = 0;
                for (const keyword of keywords) {
                    if (lowerTitle.includes(keyword.toLowerCase())) score++;
                }
                if (score > bestScore) { bestScore = score; bestMatch = pattern; }
            }
            return bestScore >= 2 ? bestMatch : 'Outro';
        }

        function detectAvatar(title) {
            const lowerTitle = title.toLowerCase();
            const avatars = [];
            for (const [avatar, keywords] of Object.entries(AVATAR_KEYWORDS)) {
                for (const keyword of keywords) {
                    if (lowerTitle.includes(keyword.toLowerCase())) {
                        if (!avatars.includes(avatar)) avatars.push(avatar);
                        break;
                    }
                }
            }
            return avatars.length > 0 ? avatars.join(', ') : 'NÃ£o identificado';
        }

        function detectTriggers(title) {
            const lowerTitle = title.toLowerCase();
            const triggers = [];
            for (const [trigger, keywords] of Object.entries(TRIGGER_KEYWORDS)) {
                for (const keyword of keywords) {
                    if (lowerTitle.includes(keyword.toLowerCase())) {
                        if (!triggers.includes(trigger)) triggers.push(trigger);
                        break;
                    }
                }
            }
            return triggers;
        }

        function calculatePerformanceScore(video, channelAvgViews) {
            let score = 50;
            if (video.ctr >= 8) score += 20;
            else if (video.ctr >= 6) score += 15;
            else if (video.ctr >= 4) score += 10;
            else if (video.ctr < 3) score -= 10;
            if (channelAvgViews > 0) {
                const viewsRatio = video.views / channelAvgViews;
                if (viewsRatio >= 3) score += 20;
                else if (viewsRatio >= 2) score += 15;
                else if (viewsRatio >= 1.5) score += 10;
                else if (viewsRatio < 0.5) score -= 10;
            }
            if (video.new_viewers_percent >= 70) score += 10;
            else if (video.new_viewers_percent >= 50) score += 5;
            else if (video.new_viewers_percent < 30) score -= 10;
            const engagementRate = video.views > 0 ? ((video.likes + video.comments) / video.views) * 100 : 0;
            if (engagementRate >= 5) score += 10;
            else if (engagementRate >= 3) score += 5;
            return Math.max(0, Math.min(100, score));
        }

        function getPerformanceTag(score) {
            if (score >= 80) return { tag: 'viral', label: 'ğŸ”¥ Viral', class: 'tag-viral' };
            if (score >= 60) return { tag: 'good', label: 'âœ… Bom', class: 'tag-good' };
            if (score >= 40) return { tag: 'regular', label: 'âš ï¸ Regular', class: 'tag-regular' };
            return { tag: 'flop', label: 'âŒ Flop', class: 'tag-flop' };
        }

        // ==================== IDIOMAS ====================
        const LANGUAGES = [
            { code: 'en', name: 'English', flag: 'ğŸ‡¬ğŸ‡§', rpmMin: 6, rpmMax: 40, rpmAvg: 15 },
            { code: 'es', name: 'EspaÃ±ol', flag: 'ğŸ‡ªğŸ‡¸', rpmMin: 6, rpmMax: 12, rpmAvg: 8 },
            { code: 'pt', name: 'PortuguÃªs', flag: 'ğŸ‡§ğŸ‡·', rpmMin: 1, rpmMax: 3, rpmAvg: 2 },
            { code: 'de', name: 'Deutsch', flag: 'ğŸ‡©ğŸ‡ª', rpmMin: 16, rpmMax: 24, rpmAvg: 18 },
            { code: 'fr', name: 'FranÃ§ais', flag: 'ğŸ‡«ğŸ‡·', rpmMin: 12, rpmMax: 20, rpmAvg: 14 },
            { code: 'it', name: 'Italiano', flag: 'ğŸ‡®ğŸ‡¹', rpmMin: 10, rpmMax: 16, rpmAvg: 12 },
            { code: 'pl', name: 'Polski', flag: 'ğŸ‡µğŸ‡±', rpmMin: 3, rpmMax: 10, rpmAvg: 5 },
            { code: 'nl', name: 'Nederlands', flag: 'ğŸ‡³ğŸ‡±', rpmMin: 20, rpmMax: 30, rpmAvg: 22 },
            { code: 'ko', name: 'í•œêµ­ì–´', flag: 'ğŸ‡°ğŸ‡·', rpmMin: 8, rpmMax: 14, rpmAvg: 10 },
            { code: 'ja', name: 'æ—¥æœ¬èª', flag: 'ğŸ‡¯ğŸ‡µ', rpmMin: 10, rpmMax: 20, rpmAvg: 14 },
            { code: 'hi', name: 'Hindi', flag: 'ğŸ‡®ğŸ‡³', rpmMin: 0.5, rpmMax: 1.5, rpmAvg: 0.8 },
            { code: 'th', name: 'à¹„à¸—à¸¢', flag: 'ğŸ‡¹ğŸ‡­', rpmMin: 2, rpmMax: 5, rpmAvg: 3 },
            { code: 'hr', name: 'Hrvatski', flag: 'ğŸ‡­ğŸ‡·', rpmMin: 3, rpmMax: 10, rpmAvg: 5 },
        ];

        // ==================== ÃCONES ====================
        const Icons = {
            menu: <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" /></svg>,
            home: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>,
            channel: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>,
            video: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z" /></svg>,
            dollar: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
            users: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>,
            pattern: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>,
            settings: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>,
            plus: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>,
            upload: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>,
            download: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>,
            trash: <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>,
            edit: <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>,
            refresh: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>,
            x: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>,
            eye: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>,
            youtube: <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>,
        };

        // ==================== COMPONENTE PRINCIPAL ====================
        function App() {
            const [channels, setChannels] = useState([]);
            const [videos, setVideos] = useState([]);
            const [patterns, setPatterns] = useState([]);
            const [config, setConfig] = useState({ youtubeApiKey: '' });
            
            const [activeTab, setActiveTab] = useState('overview');
            const [selectedChannel, setSelectedChannel] = useState('all');
            const [viewsPeriod, setViewsPeriod] = useState(30); // 7, 14, 30
            const [sidebarOpen, setSidebarOpen] = useState(window.innerWidth > 768);
            const [mobileSidebar, setMobileSidebar] = useState(false);
            const [loading, setLoading] = useState(true);
            const [dbConnected, setDbConnected] = useState(false);
            const [syncing, setSyncing] = useState(false);
            
            const [showAddChannel, setShowAddChannel] = useState(false);
            const [showAddVideo, setShowAddVideo] = useState(false);
            const [showImportCSV, setShowImportCSV] = useState(false);
            const [showChannelDetail, setShowChannelDetail] = useState(null);
            const [showSettings, setShowSettings] = useState(false);
            
            const [editingChannel, setEditingChannel] = useState(null);
            const [editingVideo, setEditingVideo] = useState(null);
            const [csvData, setCsvData] = useState([]);
            const [csvMapping, setCsvMapping] = useState({});

            const viewsChartRef = useRef(null);
            const viewsChartInstance = useRef(null);

            // ==================== LOAD DATA ====================
            useEffect(() => {
                loadData();
                loadConfig();
            }, []);

            const loadData = async () => {
                setLoading(true);
                try {
                    const { data: channelsData, error: channelsError } = await supabase.from('channels').select('*').order('created_at', { ascending: false });
                    if (channelsError) throw channelsError;
                    setChannels(channelsData || []);

                    const { data: videosData, error: videosError } = await supabase.from('videos').select('*').order('publish_date', { ascending: false });
                    if (videosError) throw videosError;
                    setVideos(videosData || []);

                    const { data: patternsData } = await supabase.from('patterns').select('*').order('times_used', { ascending: false });
                    setPatterns(patternsData || []);

                    setDbConnected(true);
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                    setDbConnected(false);
                }
                setLoading(false);
            };

            const loadConfig = () => {
                const saved = localStorage.getItem('darkDashboardConfig');
                if (saved) setConfig(JSON.parse(saved));
            };

            const saveConfig = (newConfig) => {
                setConfig(newConfig);
                localStorage.setItem('darkDashboardConfig', JSON.stringify(newConfig));
            };

            // ==================== YOUTUBE API ====================
            const syncChannelWithYouTube = async (channel) => {
                if (!config.youtubeApiKey) {
                    alert('Configure sua YouTube API Key nas ConfiguraÃ§Ãµes!');
                    setShowSettings(true);
                    return;
                }

                setSyncing(true);
                try {
                    let channelId = channel.youtube_id;
                    
                    // Se nÃ£o tem ID, tentar extrair da URL
                    if (!channelId && channel.youtube_url) {
                        const url = channel.youtube_url;
                        if (url.includes('/channel/')) {
                            channelId = url.split('/channel/')[1].split('/')[0].split('?')[0];
                        } else if (url.includes('/@')) {
                            // Buscar por handle
                            const handle = url.split('/@')[1].split('/')[0].split('?')[0];
                            const searchRes = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=channel&q=${handle}&key=${config.youtubeApiKey}`);
                            const searchData = await searchRes.json();
                            if (searchData.items?.[0]) {
                                channelId = searchData.items[0].snippet.channelId;
                            }
                        }
                    }

                    if (!channelId) {
                        alert('NÃ£o foi possÃ­vel identificar o canal. Verifique a URL.');
                        setSyncing(false);
                        return;
                    }

                    // Buscar dados do canal
                    const res = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics&id=${channelId}&key=${config.youtubeApiKey}`);
                    const data = await res.json();

                    if (data.items?.[0]) {
                        const ytChannel = data.items[0];
                        await supabase.from('channels').update({
                            youtube_id: channelId,
                            profile_pic: ytChannel.snippet.thumbnails?.default?.url,
                            subscribers: parseInt(ytChannel.statistics.subscriberCount) || 0,
                            total_views: parseInt(ytChannel.statistics.viewCount) || 0,
                        }).eq('id', channel.id);
                        
                        alert('âœ… Canal sincronizado com sucesso!');
                        loadData();
                    } else {
                        alert('Canal nÃ£o encontrado no YouTube');
                    }
                } catch (error) {
                    console.error('Erro ao sincronizar:', error);
                    alert('Erro ao sincronizar: ' + error.message);
                }
                setSyncing(false);
            };

            // ==================== CRUD CHANNELS ====================
            const saveChannel = async (e) => {
                e.preventDefault();
                const form = e.target;
                const channelData = {
                    name: form.name.value,
                    language: form.language.value,
                    niche: form.niche.value,
                    youtube_url: form.youtube_url?.value || '',
                    subscribers: parseInt(form.subscribers.value) || 0,
                    monetized: form.monetized.checked,
                    monetized_date: form.monetized_date?.value || null,
                    notes: form.notes?.value || '',
                };

                try {
                    if (editingChannel) {
                        const { error } = await supabase.from('channels').update(channelData).eq('id', editingChannel.id);
                        if (error) throw error;
                    } else {
                        const { error } = await supabase.from('channels').insert([channelData]);
                        if (error) throw error;
                    }
                    setShowAddChannel(false);
                    setEditingChannel(null);
                    loadData();
                } catch (error) {
                    alert('Erro: ' + error.message);
                }
            };

            const deleteChannel = async (id) => {
                if (!confirm('Deletar canal e todos os vÃ­deos?')) return;
                try {
                    await supabase.from('channels').delete().eq('id', id);
                    loadData();
                } catch (error) {
                    alert('Erro: ' + error.message);
                }
            };

            // ==================== CRUD VIDEOS ====================
            const saveVideo = async (e) => {
                e.preventDefault();
                const form = e.target;
                const title = form.title.value;
                
                const channelVideos = videos.filter(v => v.channel_id === form.channel_id.value);
                const channelAvgViews = channelVideos.length > 0 ? channelVideos.reduce((sum, v) => sum + (v.views || 0), 0) / channelVideos.length : 0;
                
                const videoData = {
                    channel_id: form.channel_id.value,
                    title,
                    publish_date: form.publish_date.value,
                    views: parseInt(form.views.value) || 0,
                    impressions: parseInt(form.impressions.value) || 0,
                    ctr: parseFloat(form.ctr.value) || 0,
                    avg_view_duration: form.avg_view_duration?.value || '',
                    watch_time_hours: parseFloat(form.watch_time_hours.value) || 0,
                    new_viewers_percent: parseFloat(form.new_viewers_percent.value) || 0,
                    returning_viewers_percent: 100 - (parseFloat(form.new_viewers_percent.value) || 0),
                    likes: parseInt(form.likes.value) || 0,
                    comments: parseInt(form.comments.value) || 0,
                    subscribers_gained: parseInt(form.subscribers_gained.value) || 0,
                    revenue: parseFloat(form.revenue.value) || 0,
                    rpm: parseFloat(form.rpm.value) || 0,
                    detected_pattern: detectPattern(title),
                    detected_avatar: detectAvatar(title),
                    detected_triggers: detectTriggers(title),
                    notes: form.notes?.value || '',
                };

                const perfScore = calculatePerformanceScore(videoData, channelAvgViews);
                videoData.performance_score = perfScore;
                videoData.performance_tag = getPerformanceTag(perfScore).tag;

                try {
                    if (editingVideo) {
                        await supabase.from('videos').update(videoData).eq('id', editingVideo.id);
                    } else {
                        await supabase.from('videos').insert([videoData]);
                    }
                    setShowAddVideo(false);
                    setEditingVideo(null);
                    loadData();
                } catch (error) {
                    alert('Erro: ' + error.message);
                }
            };

            const deleteVideo = async (id) => {
                if (!confirm('Deletar vÃ­deo?')) return;
                try {
                    await supabase.from('videos').delete().eq('id', id);
                    loadData();
                } catch (error) {
                    alert('Erro: ' + error.message);
                }
            };

            // ==================== CSV IMPORT ====================
            const handleCSVUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                Papa.parse(file, {
                    header: true,
                    skipEmptyLines: true,
                    complete: (results) => {
                        setCsvData(results.data);
                        const headers = results.meta.fields || [];
                        const autoMapping = {};
                        headers.forEach(h => {
                            const lowerH = h.toLowerCase();
                            if (lowerH.includes('title') || lowerH.includes('titulo') || lowerH.includes('tÃ­tulo') || lowerH.includes('content')) autoMapping[h] = 'title';
                            else if ((lowerH.includes('view') && !lowerH.includes('new') && !lowerH.includes('avg')) || lowerH.includes('visualizaÃ§')) autoMapping[h] = 'views';
                            else if (lowerH.includes('impression') || lowerH.includes('impres')) autoMapping[h] = 'impressions';
                            else if (lowerH.includes('ctr') || lowerH.includes('taxa de cliques')) autoMapping[h] = 'ctr';
                            else if (lowerH.includes('duration') || lowerH.includes('duraÃ§Ã£o') || lowerH.includes('mÃ©dia de visual')) autoMapping[h] = 'avg_view_duration';
                            else if (lowerH.includes('watch') && lowerH.includes('time') || lowerH.includes('tempo de exib')) autoMapping[h] = 'watch_time_hours';
                            else if (lowerH.includes('new') || lowerH.includes('novo')) autoMapping[h] = 'new_viewers_percent';
                            else if (lowerH.includes('like') || lowerH.includes('gost')) autoMapping[h] = 'likes';
                            else if (lowerH.includes('comment') || lowerH.includes('coment')) autoMapping[h] = 'comments';
                            else if (lowerH.includes('subscri') || lowerH.includes('inscri')) autoMapping[h] = 'subscribers_gained';
                            else if (lowerH.includes('date') || lowerH.includes('data') || lowerH.includes('fecha') || lowerH.includes('published')) autoMapping[h] = 'publish_date';
                            else if (lowerH.includes('revenue') || lowerH.includes('receita')) autoMapping[h] = 'revenue';
                            else if (lowerH.includes('rpm')) autoMapping[h] = 'rpm';
                        });
                        setCsvMapping(autoMapping);
                        setShowImportCSV(true);
                    }
                });
            };

            const importCSVVideos = async (channelId) => {
                if (!channelId) { alert('Selecione um canal!'); return; }
                const channelVideos = videos.filter(v => v.channel_id === channelId);
                const channelAvgViews = channelVideos.length > 0 ? channelVideos.reduce((sum, v) => sum + (v.views || 0), 0) / channelVideos.length : 1000;

                const newVideos = csvData.map((row) => {
                    const title = row[Object.keys(csvMapping).find(k => csvMapping[k] === 'title')] || '';
                    if (!title) return null;
                    const video = {
                        channel_id: channelId, title, publish_date: new Date().toISOString().split('T')[0],
                        views: 0, impressions: 0, ctr: 0, avg_view_duration: '', watch_time_hours: 0,
                        new_viewers_percent: 0, returning_viewers_percent: 0, likes: 0, comments: 0,
                        subscribers_gained: 0, revenue: 0, rpm: 0,
                        detected_pattern: detectPattern(title), detected_avatar: detectAvatar(title),
                        detected_triggers: detectTriggers(title), notes: 'Importado via CSV',
                    };
                    Object.entries(csvMapping).forEach(([csvCol, field]) => {
                        if (field && row[csvCol] !== undefined && row[csvCol] !== '') {
                            let value = row[csvCol];
                            if (['views', 'impressions', 'likes', 'comments', 'subscribers_gained'].includes(field)) {
                                value = parseInt(String(value).replace(/[^0-9-]/g, '')) || 0;
                            } else if (['ctr', 'watch_time_hours', 'new_viewers_percent', 'revenue', 'rpm'].includes(field)) {
                                value = parseFloat(String(value).replace(/[^0-9.,%-]/g, '').replace(',', '.').replace('%', '')) || 0;
                            } else if (field === 'publish_date') {
                                const dateVal = new Date(value);
                                if (!isNaN(dateVal.getTime())) value = dateVal.toISOString().split('T')[0];
                            }
                            video[field] = value;
                        }
                    });
                    video.returning_viewers_percent = 100 - (video.new_viewers_percent || 0);
                    const perfScore = calculatePerformanceScore(video, channelAvgViews);
                    video.performance_score = perfScore;
                    video.performance_tag = getPerformanceTag(perfScore).tag;
                    return video;
                }).filter(v => v !== null && v.title);

                if (newVideos.length === 0) { alert('Nenhum vÃ­deo vÃ¡lido encontrado'); return; }

                try {
                    await supabase.from('videos').insert(newVideos);
                    setShowImportCSV(false);
                    setCsvData([]);
                    setCsvMapping({});
                    loadData();
                    alert(`âœ… ${newVideos.length} vÃ­deos importados!`);
                } catch (error) {
                    alert('Erro: ' + error.message);
                }
            };

            // ==================== EXPORT ====================
            const exportData = (format) => {
                if (format === 'json') {
                    const data = { channels, videos, patterns, exportedAt: new Date().toISOString() };
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
                    a.download = `dark-channels-${new Date().toISOString().split('T')[0]}.json`; a.click();
                } else {
                    let csv = 'Canal,Idioma,TÃ­tulo,PadrÃ£o,Avatar,Data,Views,ImpressÃµes,CTR,Novos%,Subs+,Score,Revenue\n';
                    videos.forEach(v => {
                        const channel = channels.find(c => c.id === v.channel_id);
                        csv += `"${channel?.name || ''}","${channel?.language || ''}","${v.title}","${v.detected_pattern || ''}","${v.detected_avatar || ''}","${v.publish_date}",${v.views},${v.impressions},${v.ctr},${v.new_viewers_percent},${v.subscribers_gained},${v.performance_score},${v.revenue}\n`;
                    });
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
                    a.download = `dark-channels-${new Date().toISOString().split('T')[0]}.csv`; a.click();
                }
            };

            // ==================== STATS ====================
            const stats = {
                totalChannels: channels.length,
                totalVideos: videos.length,
                totalViews: videos.reduce((sum, v) => sum + (v.views || 0), 0),
                totalSubscribers: channels.reduce((sum, c) => sum + (c.subscribers || 0), 0),
                avgCTR: videos.length > 0 ? (videos.reduce((sum, v) => sum + (v.ctr || 0), 0) / videos.filter(v => v.ctr).length).toFixed(2) : 0,
                totalRevenue: videos.reduce((sum, v) => sum + (v.revenue || 0), 0).toFixed(2),
                avgNewViewers: videos.length > 0 ? (videos.reduce((sum, v) => sum + (v.new_viewers_percent || 0), 0) / videos.filter(v => v.new_viewers_percent).length).toFixed(1) : 0,
            };

            const filteredVideos = selectedChannel === 'all' ? videos : videos.filter(v => v.channel_id === selectedChannel);

            // ==================== CHART ====================
            useEffect(() => {
                if (activeTab === 'overview' && viewsChartRef.current && videos.length > 0) {
                    if (viewsChartInstance.current) viewsChartInstance.current.destroy();

                    const days = [...Array(viewsPeriod)].map((_, i) => {
                        const d = new Date(); d.setDate(d.getDate() - (viewsPeriod - 1 - i));
                        return d.toISOString().split('T')[0];
                    });

                    const viewsByDay = days.map(date => videos.filter(v => v.publish_date === date).reduce((sum, v) => sum + (v.views || 0), 0));

                    viewsChartInstance.current = new Chart(viewsChartRef.current, {
                        type: 'line',
                        data: {
                            labels: days.map(d => new Date(d + 'T12:00:00').toLocaleDateString('pt-BR', { day: '2-digit', month: 'short' })),
                            datasets: [{
                                label: 'Views',
                                data: viewsByDay,
                                borderColor: '#8b5cf6',
                                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: '#8b5cf6',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2,
                                pointRadius: viewsPeriod <= 14 ? 4 : 2,
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b', font: { size: 10 }, maxRotation: 45 } },
                                y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b', font: { size: 11 } } }
                            }
                        }
                    });
                }
            }, [activeTab, videos, viewsPeriod]);

            // ==================== LOADING ====================
            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="w-16 h-16 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                            <p className="text-gray-400">Conectando ao banco de dados...</p>
                        </div>
                    </div>
                );
            }

            // ==================== RENDER ====================
            return (
                <div className="min-h-screen flex">
                    {/* Mobile Overlay */}
                    {mobileSidebar && <div className="fixed inset-0 bg-black/50 z-40 md:hidden" onClick={() => setMobileSidebar(false)}></div>}
                    
                    {/* Sidebar */}
                    <aside className={`sidebar glass ${sidebarOpen ? 'sidebar-expanded' : 'sidebar-collapsed'} ${mobileSidebar ? '' : 'hidden md:flex'} flex flex-col py-4 fixed md:relative h-full z-50`}>
                        <div className="px-4 mb-6 flex items-center gap-3">
                            <div className="w-10 h-10 gradient-primary rounded-xl flex items-center justify-center text-xl flex-shrink-0">ğŸŒ™</div>
                            {sidebarOpen && <span className="font-bold text-lg whitespace-nowrap">Dark Channels</span>}
                        </div>
                        <nav className="flex-1 px-2">
                            {[
                                { id: 'overview', icon: Icons.home, label: 'VisÃ£o Geral' },
                                { id: 'channels', icon: Icons.channel, label: 'Canais' },
                                { id: 'videos', icon: Icons.video, label: 'VÃ­deos' },
                                { id: 'revenue', icon: Icons.dollar, label: 'Revenue' },
                                { id: 'audience', icon: Icons.users, label: 'PÃºblico' },
                                { id: 'patterns', icon: Icons.pattern, label: 'PadrÃµes' },
                            ].map(item => (
                                <button key={item.id} onClick={() => { setActiveTab(item.id); setMobileSidebar(false); }}
                                    className={`w-full flex items-center gap-3 px-3 py-3 rounded-xl mb-1 transition-all ${activeTab === item.id ? 'gradient-primary text-white shadow-lg shadow-indigo-500/30' : 'text-gray-400 hover:bg-white/5 hover:text-white'}`}>
                                    {item.icon}
                                    {sidebarOpen && <span className="font-medium whitespace-nowrap">{item.label}</span>}
                                </button>
                            ))}
                        </nav>
                        <div className="px-2 mt-auto">
                            <button onClick={() => setShowSettings(true)} className="w-full flex items-center gap-3 px-3 py-3 rounded-xl text-gray-400 hover:bg-white/5 hover:text-white transition">
                                {Icons.settings}
                                {sidebarOpen && <span className="font-medium">ConfiguraÃ§Ãµes</span>}
                            </button>
                        </div>
                        <div className="px-4 py-2 mt-2">
                            <div className={`flex items-center gap-2 text-xs ${dbConnected ? 'text-green-400' : 'text-red-400'}`}>
                                <div className={`w-2 h-2 rounded-full ${dbConnected ? 'bg-green-400' : 'bg-red-400'}`}></div>
                                {sidebarOpen && <span>{dbConnected ? 'Supabase OK' : 'Desconectado'}</span>}
                            </div>
                        </div>
                    </aside>

                    {/* Main */}
                    <main className="flex-1 overflow-auto md:ml-0">
                        {/* Header */}
                        <header className="glass-light sticky top-0 z-30 px-4 md:px-6 py-4 flex items-center justify-between gap-2">
                            <div className="flex items-center gap-2 md:gap-4">
                                <button onClick={() => window.innerWidth < 768 ? setMobileSidebar(!mobileSidebar) : setSidebarOpen(!sidebarOpen)} className="p-2 hover:bg-white/10 rounded-lg transition">
                                    {Icons.menu}
                                </button>
                                <div className="hidden sm:block">
                                    <h1 className="text-lg md:text-xl font-bold">
                                        {activeTab === 'overview' && 'VisÃ£o Geral'}
                                        {activeTab === 'channels' && 'Canais'}
                                        {activeTab === 'videos' && 'VÃ­deos'}
                                        {activeTab === 'revenue' && 'Revenue'}
                                        {activeTab === 'audience' && 'PÃºblico'}
                                        {activeTab === 'patterns' && 'PadrÃµes'}
                                    </h1>
                                </div>
                            </div>
                            
                            <div className="flex items-center gap-1 md:gap-2 flex-wrap justify-end">
                                <button onClick={loadData} className="p-2 hover:bg-white/10 rounded-lg transition" title="Atualizar">
                                    {Icons.refresh}
                                </button>
                                <button onClick={() => setShowAddChannel(true)} className="gradient-primary px-2 md:px-4 py-2 rounded-lg flex items-center gap-1 md:gap-2 font-medium text-xs md:text-sm shadow-lg shadow-indigo-500/30">
                                    {Icons.plus} <span className="hidden sm:inline">Canal</span>
                                </button>
                                <button onClick={() => setShowAddVideo(true)} className="bg-purple-600 hover:bg-purple-700 px-2 md:px-4 py-2 rounded-lg flex items-center gap-1 md:gap-2 font-medium text-xs md:text-sm">
                                    {Icons.video} <span className="hidden sm:inline">VÃ­deo</span>
                                </button>
                                <label className="bg-emerald-600 hover:bg-emerald-700 px-2 md:px-4 py-2 rounded-lg flex items-center gap-1 md:gap-2 font-medium text-xs md:text-sm cursor-pointer">
                                    {Icons.upload} <span className="hidden sm:inline">CSV</span>
                                    <input type="file" accept=".csv" onChange={handleCSVUpload} className="hidden" />
                                </label>
                                <div className="relative group">
                                    <button className="bg-slate-700 hover:bg-slate-600 p-2 rounded-lg">
                                        {Icons.download}
                                    </button>
                                    <div className="absolute right-0 mt-2 w-28 glass rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50">
                                        <button onClick={() => exportData('json')} className="block w-full text-left px-3 py-2 hover:bg-white/10 rounded-t-lg text-sm">JSON</button>
                                        <button onClick={() => exportData('csv')} className="block w-full text-left px-3 py-2 hover:bg-white/10 rounded-b-lg text-sm">CSV</button>
                                    </div>
                                </div>
                            </div>
                        </header>

                        {/* Content */}
                        <div className="p-4 md:p-6 animate-fadeIn">
                            {/* Stats Cards */}
                            <div className="grid grid-cols-2 sm:grid-cols-4 xl:grid-cols-7 gap-3 md:gap-4 mb-6">
                                {[
                                    { label: 'Canais', value: stats.totalChannels, icon: 'ğŸ“º', color: 'from-blue-500 to-cyan-500' },
                                    { label: 'VÃ­deos', value: stats.totalVideos, icon: 'ğŸ¬', color: 'from-purple-500 to-pink-500' },
                                    { label: 'Views', value: stats.totalViews.toLocaleString(), icon: 'ğŸ‘ï¸', color: 'from-orange-500 to-red-500' },
                                    { label: 'Inscritos', value: stats.totalSubscribers.toLocaleString(), icon: 'ğŸ‘¥', color: 'from-green-500 to-emerald-500' },
                                    { label: 'CTR MÃ©dio', value: stats.avgCTR + '%', icon: 'ğŸ“Š', color: 'from-yellow-500 to-orange-500' },
                                    { label: 'Novos', value: stats.avgNewViewers + '%', icon: 'âœ¨', color: 'from-cyan-500 to-blue-500' },
                                    { label: 'Revenue', value: '$' + stats.totalRevenue, icon: 'ğŸ’°', color: 'from-emerald-500 to-green-500', highlight: true },
                                ].map((stat, i) => (
                                    <div key={i} className={`glass rounded-xl md:rounded-2xl p-3 md:p-4 ${stat.highlight ? 'ring-2 ring-emerald-500/50' : ''}`}>
                                        <div className="flex items-center justify-between mb-1 md:mb-2">
                                            <span className="text-xl md:text-2xl">{stat.icon}</span>
                                        </div>
                                        <p className="text-lg md:text-2xl font-bold">{stat.value}</p>
                                        <p className="text-xs text-gray-400">{stat.label}</p>
                                    </div>
                                ))}
                            </div>

                            {/* ==================== OVERVIEW ==================== */}
                            {activeTab === 'overview' && (
                                <div className="grid lg:grid-cols-2 gap-4 md:gap-6">
                                    {/* Views Chart */}
                                    <div className="glass rounded-2xl p-4 md:p-6">
                                        <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-4">
                                            <h3 className="text-lg font-semibold">ğŸ“ˆ Views</h3>
                                            <div className="flex gap-1">
                                                {[7, 14, 30].map(p => (
                                                    <button key={p} onClick={() => setViewsPeriod(p)}
                                                        className={`period-btn px-3 py-1 rounded-lg text-sm ${viewsPeriod === p ? 'active text-white' : 'bg-white/10 text-gray-400 hover:bg-white/20'}`}>
                                                        {p}d
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                        <div className="h-64">
                                            <canvas ref={viewsChartRef}></canvas>
                                        </div>
                                    </div>

                                    {/* Top Videos */}
                                    <div className="glass rounded-2xl p-4 md:p-6">
                                        <h3 className="text-lg font-semibold mb-4">ğŸ† Top VÃ­deos</h3>
                                        <div className="space-y-3">
                                            {videos.sort((a, b) => (b.views || 0) - (a.views || 0)).slice(0, 5).map((v, i) => {
                                                const channel = channels.find(c => c.id === v.channel_id);
                                                const lang = LANGUAGES.find(l => l.code === channel?.language);
                                                const perfTag = getPerformanceTag(v.performance_score || 50);
                                                return (
                                                    <div key={v.id} className="flex items-center gap-3 p-3 bg-white/5 rounded-xl hover:bg-white/10 transition">
                                                        <span className="text-xl md:text-2xl w-6 md:w-8">{i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : (i + 1) + '.'}</span>
                                                        <div className="flex-1 min-w-0">
                                                            <p className="truncate text-sm font-medium">{v.title}</p>
                                                            <div className="flex items-center gap-2 mt-1 flex-wrap">
                                                                <span className="text-xs text-gray-400">{lang?.flag} {channel?.name}</span>
                                                                <span className={`text-xs px-2 py-0.5 rounded-full ${perfTag.class}`}>{perfTag.label}</span>
                                                            </div>
                                                        </div>
                                                        <div className="text-right">
                                                            <p className="font-bold text-indigo-400">{(v.views || 0).toLocaleString()}</p>
                                                            <p className="text-xs text-gray-400">{v.ctr}% CTR</p>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                            {videos.length === 0 && <p className="text-gray-400 text-center py-8">Nenhum vÃ­deo</p>}
                                        </div>
                                    </div>

                                    {/* Performance por Canal */}
                                    <div className="glass rounded-2xl p-4 md:p-6 lg:col-span-2">
                                        <h3 className="text-lg font-semibold mb-4">ğŸŒ Performance por Canal</h3>
                                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                                            {channels.map(channel => {
                                                const lang = LANGUAGES.find(l => l.code === channel.language);
                                                const channelVideos = videos.filter(v => v.channel_id === channel.id);
                                                const totalViews = channelVideos.reduce((sum, v) => sum + (v.views || 0), 0);
                                                const avgCTR = channelVideos.length > 0 ? (channelVideos.reduce((sum, v) => sum + (v.ctr || 0), 0) / channelVideos.filter(v => v.ctr).length).toFixed(1) : 0;
                                                const estimatedRevenue = (totalViews / 1000) * (lang?.rpmAvg || 0);
                                                
                                                return (
                                                    <div key={channel.id} onClick={() => setShowChannelDetail(channel)}
                                                        className="glass-light rounded-xl p-4 cursor-pointer hover:ring-2 hover:ring-indigo-500/50 transition">
                                                        <div className="flex items-center gap-2 mb-3">
                                                            {channel.profile_pic ? (
                                                                <img src={channel.profile_pic} alt="" className="w-10 h-10 rounded-full" />
                                                            ) : (
                                                                <span className="text-2xl">{lang?.flag}</span>
                                                            )}
                                                            <div className="flex-1 min-w-0">
                                                                <p className="font-semibold truncate">{channel.name}</p>
                                                                <p className="text-xs text-gray-400">{channelVideos.length} vÃ­deos</p>
                                                            </div>
                                                        </div>
                                                        <div className="space-y-1 text-sm">
                                                            <div className="flex justify-between"><span className="text-gray-400">Views</span><span className="font-bold">{totalViews.toLocaleString()}</span></div>
                                                            <div className="flex justify-between"><span className="text-gray-400">CTR</span><span className={parseFloat(avgCTR) >= 6 ? 'text-green-400' : 'text-yellow-400'}>{avgCTR}%</span></div>
                                                            <div className="flex justify-between"><span className="text-gray-400">Est.</span><span className="text-emerald-400">${estimatedRevenue.toFixed(2)}</span></div>
                                                        </div>
                                                        {channel.monetized && <div className="mt-2 text-center"><span className="text-xs px-2 py-1 bg-emerald-500/20 text-emerald-400 rounded-full">ğŸ’° Monetizado</span></div>}
                                                    </div>
                                                );
                                            })}
                                            {channels.length === 0 && (
                                                <div className="col-span-full text-center py-8">
                                                    <p className="text-gray-400 mb-4">Nenhum canal cadastrado</p>
                                                    <button onClick={() => setShowAddChannel(true)} className="gradient-primary px-6 py-2 rounded-lg">Adicionar Canal</button>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* ==================== CHANNELS ==================== */}
                            {activeTab === 'channels' && (
                                <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {channels.map(channel => {
                                        const lang = LANGUAGES.find(l => l.code === channel.language);
                                        const channelVideos = videos.filter(v => v.channel_id === channel.id);
                                        const totalViews = channelVideos.reduce((sum, v) => sum + (v.views || 0), 0);
                                        const avgCTR = channelVideos.length > 0 ? (channelVideos.reduce((sum, v) => sum + (v.ctr || 0), 0) / channelVideos.filter(v => v.ctr).length).toFixed(2) : 0;
                                        const totalRevenue = channelVideos.reduce((sum, v) => sum + (v.revenue || 0), 0);
                                        const estimatedRevenue = (totalViews / 1000) * (lang?.rpmAvg || 0);
                                        
                                        return (
                                            <div key={channel.id} className="glass rounded-2xl p-4 md:p-6 hover:ring-2 hover:ring-indigo-500/30 transition">
                                                <div className="flex justify-between items-start mb-4">
                                                    <div className="flex items-center gap-3">
                                                        {channel.profile_pic ? (
                                                            <img src={channel.profile_pic} alt="" className="w-12 h-12 rounded-xl" />
                                                        ) : (
                                                            <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-2xl">{lang?.flag}</div>
                                                        )}
                                                        <div>
                                                            <h3 className="font-bold">{channel.name}</h3>
                                                            <p className="text-sm text-gray-400">{lang?.name} â€¢ {channel.niche}</p>
                                                        </div>
                                                    </div>
                                                    <div className="flex gap-1">
                                                        <button onClick={() => syncChannelWithYouTube(channel)} disabled={syncing} className="p-2 hover:bg-white/10 rounded-lg text-gray-400 hover:text-red-500" title="Sincronizar YouTube">
                                                            {syncing ? <div className="w-4 h-4 border-2 border-red-500 border-t-transparent rounded-full animate-spin"></div> : Icons.youtube}
                                                        </button>
                                                        <button onClick={() => { setEditingChannel(channel); setShowAddChannel(true); }} className="p-2 hover:bg-white/10 rounded-lg text-gray-400 hover:text-white">{Icons.edit}</button>
                                                        <button onClick={() => deleteChannel(channel.id)} className="p-2 hover:bg-white/10 rounded-lg text-gray-400 hover:text-red-400">{Icons.trash}</button>
                                                    </div>
                                                </div>
                                                <div className="grid grid-cols-2 gap-3 mb-4">
                                                    <div className="bg-white/5 rounded-xl p-3"><p className="text-xs text-gray-400">VÃ­deos</p><p className="text-xl font-bold">{channelVideos.length}</p></div>
                                                    <div className="bg-white/5 rounded-xl p-3"><p className="text-xs text-gray-400">Inscritos</p><p className="text-xl font-bold">{(channel.subscribers || 0).toLocaleString()}</p></div>
                                                    <div className="bg-white/5 rounded-xl p-3"><p className="text-xs text-gray-400">Views</p><p className="text-xl font-bold">{totalViews.toLocaleString()}</p></div>
                                                    <div className="bg-white/5 rounded-xl p-3"><p className="text-xs text-gray-400">CTR</p><p className={`text-xl font-bold ${parseFloat(avgCTR) >= 6 ? 'text-green-400' : 'text-yellow-400'}`}>{avgCTR}%</p></div>
                                                </div>
                                                <div className="flex justify-between items-center pt-4 border-t border-white/10">
                                                    <div>
                                                        <p className="text-xs text-gray-400">RPM: ${lang?.rpmMin}-{lang?.rpmMax}</p>
                                                        <p className="text-lg font-bold text-emerald-400">{totalRevenue > 0 ? `$${totalRevenue.toFixed(2)}` : `~$${estimatedRevenue.toFixed(2)}`}</p>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        {channel.monetized ? <span className="px-3 py-1 bg-emerald-500/20 text-emerald-400 rounded-full text-sm">ğŸ’°</span> : <span className="px-3 py-1 bg-yellow-500/20 text-yellow-400 rounded-full text-sm">â³</span>}
                                                        <button onClick={() => setShowChannelDetail(channel)} className="p-2 hover:bg-white/10 rounded-lg text-gray-400 hover:text-white">{Icons.eye}</button>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                    {channels.length === 0 && (
                                        <div className="col-span-full text-center py-16">
                                            <p className="text-6xl mb-4">ğŸ“º</p>
                                            <p className="text-gray-400 mb-4">Nenhum canal cadastrado</p>
                                            <button onClick={() => setShowAddChannel(true)} className="gradient-primary px-6 py-3 rounded-xl font-medium">Adicionar Primeiro Canal</button>
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* ==================== VIDEOS ==================== */}
                            {activeTab === 'videos' && (
                                <div>
                                    <div className="flex flex-wrap gap-3 mb-4">
                                        <select value={selectedChannel} onChange={(e) => setSelectedChannel(e.target.value)} className="rounded-xl px-4 py-2">
                                            <option value="all">Todos os Canais</option>
                                            {channels.map(c => { const lang = LANGUAGES.find(l => l.code === c.language); return <option key={c.id} value={c.id}>{lang?.flag} {c.name}</option>; })}
                                        </select>
                                        <span className="text-gray-400 self-center">{filteredVideos.length} vÃ­deos</span>
                                    </div>
                                    <div className="glass rounded-2xl overflow-hidden">
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-sm">
                                                <thead className="bg-white/5">
                                                    <tr>
                                                        <th className="text-left p-3 text-xs font-semibold text-gray-400">Canal</th>
                                                        <th className="text-left p-3 text-xs font-semibold text-gray-400">TÃ­tulo</th>
                                                        <th className="text-left p-3 text-xs font-semibold text-gray-400 hidden lg:table-cell">PadrÃ£o</th>
                                                        <th className="text-right p-3 text-xs font-semibold text-gray-400">Views</th>
                                                        <th className="text-right p-3 text-xs font-semibold text-gray-400 hidden md:table-cell">CTR</th>
                                                        <th className="text-right p-3 text-xs font-semibold text-gray-400 hidden lg:table-cell">Novos%</th>
                                                        <th className="text-center p-3 text-xs font-semibold text-gray-400">Score</th>
                                                        <th className="text-center p-3 text-xs font-semibold text-gray-400">AÃ§Ãµes</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {filteredVideos.map(video => {
                                                        const channel = channels.find(c => c.id === video.channel_id);
                                                        const lang = LANGUAGES.find(l => l.code === channel?.language);
                                                        const perfTag = getPerformanceTag(video.performance_score || 50);
                                                        return (
                                                            <tr key={video.id} className="border-t border-white/5 hover:bg-white/5 transition">
                                                                <td className="p-3"><span className="text-lg">{lang?.flag}</span></td>
                                                                <td className="p-3 max-w-[150px] md:max-w-[250px]"><p className="truncate" title={video.title}>{video.title}</p></td>
                                                                <td className="p-3 hidden lg:table-cell"><span className="text-xs px-2 py-1 bg-indigo-500/20 text-indigo-300 rounded-full">{video.detected_pattern || 'N/A'}</span></td>
                                                                <td className="p-3 text-right font-bold">{(video.views || 0).toLocaleString()}</td>
                                                                <td className="p-3 text-right hidden md:table-cell"><span className={`font-medium ${(video.ctr || 0) >= 6 ? 'text-green-400' : 'text-yellow-400'}`}>{video.ctr || 0}%</span></td>
                                                                <td className="p-3 text-right hidden lg:table-cell"><span className={(video.new_viewers_percent || 0) >= 60 ? 'text-green-400' : 'text-yellow-400'}>{video.new_viewers_percent || 0}%</span></td>
                                                                <td className="p-3 text-center"><span className={`text-xs px-2 py-1 rounded-full ${perfTag.class}`}>{perfTag.label}</span></td>
                                                                <td className="p-3">
                                                                    <div className="flex justify-center gap-1">
                                                                        <button onClick={() => { setEditingVideo(video); setShowAddVideo(true); }} className="p-2 hover:bg-white/10 rounded-lg text-gray-400 hover:text-white">{Icons.edit}</button>
                                                                        <button onClick={() => deleteVideo(video.id)} className="p-2 hover:bg-white/10 rounded-lg text-gray-400 hover:text-red-400">{Icons.trash}</button>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        );
                                                    })}
                                                </tbody>
                                            </table>
                                            {filteredVideos.length === 0 && <div className="text-center py-16"><p className="text-6xl mb-4">ğŸ¬</p><p className="text-gray-400">Nenhum vÃ­deo</p></div>}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* ==================== REVENUE ==================== */}
                            {activeTab === 'revenue' && (
                                <div className="space-y-6">
                                    <div className="glass rounded-2xl p-4 md:p-6">
                                        <h3 className="text-lg font-semibold mb-4">ğŸ’° RPM por Idioma</h3>
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-sm">
                                                <thead className="bg-white/5">
                                                    <tr>
                                                        <th className="text-left p-3">Idioma</th>
                                                        <th className="text-right p-3">RPM MÃ­n</th>
                                                        <th className="text-right p-3">RPM MÃ¡x</th>
                                                        <th className="text-right p-3">RPM MÃ©dio</th>
                                                        <th className="text-right p-3">10K Views</th>
                                                        <th className="text-right p-3">100K Views</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {LANGUAGES.sort((a, b) => b.rpmAvg - a.rpmAvg).map(lang => (
                                                        <tr key={lang.code} className="border-t border-white/5 hover:bg-white/5">
                                                            <td className="p-3 font-medium">{lang.flag} {lang.name}</td>
                                                            <td className="p-3 text-right text-gray-400">${lang.rpmMin}</td>
                                                            <td className="p-3 text-right text-gray-400">${lang.rpmMax}</td>
                                                            <td className="p-3 text-right font-bold text-indigo-400">${lang.rpmAvg}</td>
                                                            <td className="p-3 text-right text-emerald-400">${(10 * lang.rpmAvg).toFixed(2)}</td>
                                                            <td className="p-3 text-right text-emerald-400 font-bold">${(100 * lang.rpmAvg).toFixed(2)}</td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* ==================== AUDIENCE ==================== */}
                            {activeTab === 'audience' && (
                                <div className="grid lg:grid-cols-2 gap-6">
                                    <div className="glass rounded-2xl p-4 md:p-6">
                                        <h3 className="text-lg font-semibold mb-4">ğŸ‘¥ Novos vs Recorrentes</h3>
                                        {(() => {
                                            const avgNew = videos.length > 0 ? videos.reduce((sum, v) => sum + (v.new_viewers_percent || 0), 0) / videos.filter(v => v.new_viewers_percent).length : 0;
                                            const avgReturning = 100 - avgNew;
                                            return (
                                                <div className="space-y-4">
                                                    <div>
                                                        <div className="flex justify-between mb-1"><span className="text-sm">âœ¨ Novos</span><span className={`font-bold ${avgNew >= 50 ? 'text-green-400' : 'text-yellow-400'}`}>{avgNew.toFixed(1)}%</span></div>
                                                        <div className="bg-white/10 rounded-full h-4"><div className="bg-gradient-to-r from-green-500 to-emerald-500 h-4 rounded-full" style={{ width: `${avgNew}%` }}></div></div>
                                                    </div>
                                                    <div>
                                                        <div className="flex justify-between mb-1"><span className="text-sm">ğŸ”„ Recorrentes</span><span className="font-bold text-blue-400">{avgReturning.toFixed(1)}%</span></div>
                                                        <div className="bg-white/10 rounded-full h-4"><div className="bg-gradient-to-r from-blue-500 to-indigo-500 h-4 rounded-full" style={{ width: `${avgReturning}%` }}></div></div>
                                                    </div>
                                                    <div className={`mt-4 p-3 rounded-xl ${avgNew >= 50 ? 'bg-green-500/20' : 'bg-yellow-500/20'}`}>
                                                        <p className="text-sm">{avgNew >= 60 ? 'ğŸš€ Excelente! Seus vÃ­deos estÃ£o atraindo muitos novos viewers.' : avgNew >= 50 ? 'âœ… Bom equilÃ­brio entre novos e recorrentes.' : 'âš ï¸ Muitos recorrentes. Tente variar os temas para atrair novos.'}</p>
                                                    </div>
                                                </div>
                                            );
                                        })()}
                                    </div>
                                    <div className="glass rounded-2xl p-4 md:p-6">
                                        <h3 className="text-lg font-semibold mb-4">ğŸ“ Por Canal</h3>
                                        <div className="space-y-3">
                                            {channels.map(channel => {
                                                const lang = LANGUAGES.find(l => l.code === channel.language);
                                                const channelVideos = videos.filter(v => v.channel_id === channel.id);
                                                const avgNew = channelVideos.length > 0 ? channelVideos.reduce((sum, v) => sum + (v.new_viewers_percent || 0), 0) / channelVideos.filter(v => v.new_viewers_percent).length : 0;
                                                return (
                                                    <div key={channel.id} className="p-3 bg-white/5 rounded-xl flex items-center gap-3">
                                                        <span className="text-2xl">{lang?.flag}</span>
                                                        <div className="flex-1"><p className="font-medium">{channel.name}</p><p className="text-xs text-gray-400">{channelVideos.length} vÃ­deos</p></div>
                                                        <div className="text-right"><p className={`font-bold ${avgNew >= 50 ? 'text-green-400' : 'text-yellow-400'}`}>{avgNew.toFixed(1)}% novos</p></div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* ==================== PATTERNS ==================== */}
                            {activeTab === 'patterns' && (
                                <div className="grid lg:grid-cols-2 gap-6">
                                    <div className="glass rounded-2xl p-4 md:p-6">
                                        <h3 className="text-lg font-semibold mb-4">ğŸ§  AnÃ¡lise de PadrÃµes</h3>
                                        <div className="space-y-3">
                                            {Object.entries(videos.reduce((acc, v) => { const p = v.detected_pattern || 'Outro'; if (!acc[p]) acc[p] = { videos: [], views: 0, ctr: 0 }; acc[p].videos.push(v); acc[p].views += v.views || 0; acc[p].ctr += v.ctr || 0; return acc; }, {}))
                                            .map(([pattern, data]) => ({ pattern, count: data.videos.length, totalViews: data.views, avgCTR: (data.ctr / data.videos.length).toFixed(2), avgViews: Math.round(data.views / data.videos.length) }))
                                            .sort((a, b) => b.totalViews - a.totalViews).slice(0, 10).map((item, i) => (
                                                <div key={item.pattern} className="p-4 bg-white/5 rounded-xl">
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div><h4 className="font-semibold">{item.pattern}</h4><p className="text-xs text-gray-400">{item.count} vÃ­deos</p></div>
                                                        <div className="text-right"><p className="font-bold text-indigo-400">{item.totalViews.toLocaleString()} views</p><p className="text-xs text-gray-400">~{item.avgViews.toLocaleString()}/vÃ­deo</p></div>
                                                    </div>
                                                    <div className="flex items-center gap-4 mt-2">
                                                        <div className="flex-1 bg-white/10 rounded-full h-2"><div className={`h-2 rounded-full ${parseFloat(item.avgCTR) >= 6 ? 'bg-green-500' : parseFloat(item.avgCTR) >= 4 ? 'bg-yellow-500' : 'bg-red-500'}`} style={{ width: `${Math.min(parseFloat(item.avgCTR) * 10, 100)}%` }}></div></div>
                                                        <span className={`text-sm font-medium ${parseFloat(item.avgCTR) >= 6 ? 'text-green-400' : parseFloat(item.avgCTR) >= 4 ? 'text-yellow-400' : 'text-red-400'}`}>{item.avgCTR}% CTR</span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="glass rounded-2xl p-4 md:p-6">
                                        <h3 className="text-lg font-semibold mb-4">âš ï¸ Alertas de SaturaÃ§Ã£o</h3>
                                        {(() => {
                                            const last7Days = new Date(); last7Days.setDate(last7Days.getDate() - 7);
                                            const recentPatterns = videos.filter(v => new Date(v.publish_date) >= last7Days).reduce((acc, v) => { const p = v.detected_pattern || 'Outro'; acc[p] = (acc[p] || 0) + 1; return acc; }, {});
                                            const saturated = Object.entries(recentPatterns).filter(([_, count]) => count >= 3).sort((a, b) => b[1] - a[1]);
                                            if (saturated.length === 0) return <div className="text-center py-8"><p className="text-4xl mb-2">âœ…</p><p className="text-green-400">Boa diversidade!</p></div>;
                                            return saturated.map(([pattern, count]) => (
                                                <div key={pattern} className="p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-xl mb-3">
                                                    <div className="flex items-center gap-2 mb-2"><span className="text-yellow-400">âš ï¸</span><span className="font-semibold">{pattern}</span></div>
                                                    <p className="text-sm text-gray-300">Usado <strong>{count}x</strong> nos Ãºltimos 7 dias</p>
                                                    <p className="text-xs text-gray-400 mt-1">SugestÃ£o: Experimente HeroÃ­smo, Bondade ou Identidade Secreta</p>
                                                </div>
                                            ));
                                        })()}
                                    </div>
                                </div>
                            )}
                        </div>
                    </main>

                    {/* ==================== MODALS ==================== */}
                    
                    {/* Settings Modal */}
                    {showSettings && (
                        <div className="fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50">
                            <div className="glass rounded-2xl p-6 w-full max-w-md animate-fadeIn">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-xl font-bold">âš™ï¸ ConfiguraÃ§Ãµes</h2>
                                    <button onClick={() => setShowSettings(false)} className="p-2 hover:bg-white/10 rounded-lg">{Icons.x}</button>
                                </div>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm text-gray-400 mb-1">YouTube API Key</label>
                                        <input type="text" value={config.youtubeApiKey || ''} onChange={(e) => saveConfig({ ...config, youtubeApiKey: e.target.value })}
                                            className="w-full rounded-xl px-4 py-3" placeholder="AIza..." />
                                        <p className="text-xs text-gray-500 mt-2">
                                            Obtenha em: <a href="https://console.cloud.google.com/apis/credentials" target="_blank" className="text-indigo-400 hover:underline">Google Cloud Console</a>
                                        </p>
                                    </div>
                                    <div className="pt-4 border-t border-white/10">
                                        <h4 className="font-semibold mb-2">ğŸ“– Como obter a API Key:</h4>
                                        <ol className="text-sm text-gray-400 space-y-1 list-decimal list-inside">
                                            <li>Acesse Google Cloud Console</li>
                                            <li>Crie um projeto (ou use existente)</li>
                                            <li>Ative "YouTube Data API v3"</li>
                                            <li>Crie uma credencial (API Key)</li>
                                            <li>Cole aqui!</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Add Channel Modal */}
                    {showAddChannel && (
                        <div className="fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50 overflow-y-auto">
                            <div className="glass rounded-2xl p-6 w-full max-w-lg my-8 animate-fadeIn">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-xl font-bold">{editingChannel ? 'âœï¸ Editar Canal' : 'â• Novo Canal'}</h2>
                                    <button onClick={() => { setShowAddChannel(false); setEditingChannel(null); }} className="p-2 hover:bg-white/10 rounded-lg">{Icons.x}</button>
                                </div>
                                <form onSubmit={saveChannel} className="space-y-4">
                                    <div><label className="block text-sm text-gray-400 mb-1">Nome *</label><input name="name" required defaultValue={editingChannel?.name || ''} className="w-full rounded-xl px-4 py-3" placeholder="Hidden Heirs BL" /></div>
                                    <div><label className="block text-sm text-gray-400 mb-1">Idioma *</label><select name="language" required defaultValue={editingChannel?.language || ''} className="w-full rounded-xl px-4 py-3"><option value="">Selecione...</option>{LANGUAGES.map(l => <option key={l.code} value={l.code}>{l.flag} {l.name} (RPM ${l.rpmMin}-{l.rpmMax})</option>)}</select></div>
                                    <div><label className="block text-sm text-gray-400 mb-1">Nicho</label><input name="niche" defaultValue={editingChannel?.niche || ''} className="w-full rounded-xl px-4 py-3" placeholder="BL Omegaverse" /></div>
                                    <div><label className="block text-sm text-gray-400 mb-1">URL do Canal</label><input name="youtube_url" type="url" defaultValue={editingChannel?.youtube_url || ''} className="w-full rounded-xl px-4 py-3" placeholder="https://youtube.com/@..." /></div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><label className="block text-sm text-gray-400 mb-1">Inscritos</label><input name="subscribers" type="number" defaultValue={editingChannel?.subscribers || ''} className="w-full rounded-xl px-4 py-3" placeholder="0" /></div>
                                        <div><label className="block text-sm text-gray-400 mb-1">Data MonetizaÃ§Ã£o</label><input name="monetized_date" type="date" defaultValue={editingChannel?.monetized_date || ''} className="w-full rounded-xl px-4 py-3" /></div>
                                    </div>
                                    <div className="flex items-center gap-3"><input name="monetized" type="checkbox" id="monetized" defaultChecked={editingChannel?.monetized || false} className="w-5 h-5" /><label htmlFor="monetized">Monetizado</label></div>
                                    <div><label className="block text-sm text-gray-400 mb-1">Notas</label><textarea name="notes" defaultValue={editingChannel?.notes || ''} className="w-full rounded-xl px-4 py-3 h-20" placeholder="..."></textarea></div>
                                    <div className="flex gap-3 pt-4">
                                        <button type="button" onClick={() => { setShowAddChannel(false); setEditingChannel(null); }} className="flex-1 bg-slate-700 hover:bg-slate-600 py-3 rounded-xl font-medium">Cancelar</button>
                                        <button type="submit" className="flex-1 gradient-primary py-3 rounded-xl font-medium">Salvar</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* Add Video Modal */}
                    {showAddVideo && (
                        <div className="fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50 overflow-y-auto">
                            <div className="glass rounded-2xl p-6 w-full max-w-2xl my-8 animate-fadeIn">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-xl font-bold">{editingVideo ? 'âœï¸ Editar VÃ­deo' : 'â• Novo VÃ­deo'}</h2>
                                    <button onClick={() => { setShowAddVideo(false); setEditingVideo(null); }} className="p-2 hover:bg-white/10 rounded-lg">{Icons.x}</button>
                                </div>
                                <form onSubmit={saveVideo} className="space-y-4">
                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div><label className="block text-sm text-gray-400 mb-1">Canal *</label><select name="channel_id" required defaultValue={editingVideo?.channel_id || ''} className="w-full rounded-xl px-4 py-3"><option value="">Selecione...</option>{channels.map(c => { const lang = LANGUAGES.find(l => l.code === c.language); return <option key={c.id} value={c.id}>{lang?.flag} {c.name}</option>; })}</select></div>
                                        <div><label className="block text-sm text-gray-400 mb-1">Data *</label><input name="publish_date" type="date" required defaultValue={editingVideo?.publish_date || new Date().toISOString().split('T')[0]} className="w-full rounded-xl px-4 py-3" /></div>
                                    </div>
                                    <div><label className="block text-sm text-gray-400 mb-1">TÃ­tulo *</label><input name="title" required defaultValue={editingVideo?.title || ''} className="w-full rounded-xl px-4 py-3" placeholder="CEO Alpha Signed..." /><p className="text-xs text-gray-500 mt-1">PadrÃ£o detectado automaticamente</p></div>
                                    <div className="border-t border-white/10 pt-4">
                                        <h3 className="font-semibold mb-3">ğŸ“Š MÃ©tricas</h3>
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                                            <div><label className="block text-xs text-gray-400 mb-1">Views</label><input name="views" type="number" defaultValue={editingVideo?.views || ''} className="w-full rounded-xl px-3 py-2" /></div>
                                            <div><label className="block text-xs text-gray-400 mb-1">ImpressÃµes</label><input name="impressions" type="number" defaultValue={editingVideo?.impressions || ''} className="w-full rounded-xl px-3 py-2" /></div>
                                            <div><label className="block text-xs text-gray-400 mb-1">CTR (%)</label><input name="ctr" type="number" step="0.01" defaultValue={editingVideo?.ctr || ''} className="w-full rounded-xl px-3 py-2" /></div>
                                            <div><label className="block text-xs text-gray-400 mb-1">DuraÃ§Ã£o</label><input name="avg_view_duration" defaultValue={editingVideo?.avg_view_duration || ''} className="w-full rounded-xl px-3 py-2" /></div>
                                            <div><label className="block text-xs text-gray-400 mb-1">Watch (h)</label><input name="watch_time_hours" type="number" step="0.1" defaultValue={editingVideo?.watch_time_hours || ''} className="w-full rounded-xl px-3 py-2" /></div>
                                            <div><label className="block text-xs text-gray-400 mb-1">Novos (%)</label><input name="new_viewers_percent" type="number" step="0.1" defaultValue={editingVideo?.new_viewers_percent || ''} className="w-full rounded-xl px-3 py-2" /></div>
                                            <div><label className="block text-xs text-gray-400 mb-1">Likes</label><input name="likes" type="number" defaultValue={editingVideo?.likes || ''} className="w-full rounded-xl px-3 py-2" /></div>
                                            <div><label className="block text-xs text-gray-400 mb-1">Comments</label><input name="comments" type="number" defaultValue={editingVideo?.comments || ''} className="w-full rounded-xl px-3 py-2" /></div>
                                        </div>
                                    </div>
                                    <div className="border-t border-white/10 pt-4">
                                        <h3 className="font-semibold mb-3">ğŸ’° Revenue</h3>
                                        <div className="grid grid-cols-3 gap-3">
                                            <div><label className="block text-xs text-gray-400 mb-1">Subs+</label><input name="subscribers_gained" type="number" defaultValue={editingVideo?.subscribers_gained || ''} className="w-full rounded-xl px-3 py-2" /></div>
                                            <div><label className="block text-xs text-gray-400 mb-1">Revenue ($)</label><input name="revenue" type="number" step="0.01" defaultValue={editingVideo?.revenue || ''} className="w-full rounded-xl px-3 py-2" /></div>
                                            <div><label className="block text-xs text-gray-400 mb-1">RPM ($)</label><input name="rpm" type="number" step="0.01" defaultValue={editingVideo?.rpm || ''} className="w-full rounded-xl px-3 py-2" /></div>
                                        </div>
                                    </div>
                                    <div><label className="block text-sm text-gray-400 mb-1">Notas</label><textarea name="notes" defaultValue={editingVideo?.notes || ''} className="w-full rounded-xl px-4 py-3 h-16"></textarea></div>
                                    <div className="flex gap-3 pt-4">
                                        <button type="button" onClick={() => { setShowAddVideo(false); setEditingVideo(null); }} className="flex-1 bg-slate-700 hover:bg-slate-600 py-3 rounded-xl font-medium">Cancelar</button>
                                        <button type="submit" className="flex-1 gradient-primary py-3 rounded-xl font-medium">Salvar</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* CSV Import Modal */}
                    {showImportCSV && (
                        <div className="fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50 overflow-y-auto">
                            <div className="glass rounded-2xl p-6 w-full max-w-3xl my-8 animate-fadeIn">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-xl font-bold">ğŸ“¥ Importar CSV</h2>
                                    <button onClick={() => { setShowImportCSV(false); setCsvData([]); setCsvMapping({}); }} className="p-2 hover:bg-white/10 rounded-lg">{Icons.x}</button>
                                </div>
                                <p className="text-gray-400 mb-4">{csvData.length} linhas. Mapeie as colunas:</p>
                                <div className="mb-4"><label className="block text-sm text-gray-400 mb-1">Canal *</label><select id="csvChannelId" className="w-full rounded-xl px-4 py-3"><option value="">Selecione...</option>{channels.map(c => { const lang = LANGUAGES.find(l => l.code === c.language); return <option key={c.id} value={c.id}>{lang?.flag} {c.name}</option>; })}</select></div>
                                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 mb-4">
                                    {Object.keys(csvData[0] || {}).map(col => (
                                        <div key={col} className="bg-white/5 rounded-xl p-3">
                                            <p className="text-xs text-gray-400 mb-1 truncate" title={col}>{col}</p>
                                            <select value={csvMapping[col] || ''} onChange={(e) => setCsvMapping({...csvMapping, [col]: e.target.value})} className="w-full rounded-lg px-2 py-1 text-sm">
                                                <option value="">Ignorar</option>
                                                <option value="title">TÃ­tulo</option>
                                                <option value="publish_date">Data</option>
                                                <option value="views">Views</option>
                                                <option value="impressions">ImpressÃµes</option>
                                                <option value="ctr">CTR</option>
                                                <option value="avg_view_duration">DuraÃ§Ã£o</option>
                                                <option value="watch_time_hours">Watch Time</option>
                                                <option value="new_viewers_percent">Novos %</option>
                                                <option value="likes">Likes</option>
                                                <option value="comments">ComentÃ¡rios</option>
                                                <option value="subscribers_gained">Subs+</option>
                                                <option value="revenue">Revenue</option>
                                                <option value="rpm">RPM</option>
                                            </select>
                                        </div>
                                    ))}
                                </div>
                                <div className="bg-indigo-500/20 border border-indigo-500/50 rounded-xl p-3 mb-4"><p className="text-sm">ğŸ§  <strong>ExtraÃ§Ã£o automÃ¡tica:</strong> PadrÃ£o, avatar e gatilhos detectados pelo tÃ­tulo.</p></div>
                                <div className="flex gap-3">
                                    <button onClick={() => { setShowImportCSV(false); setCsvData([]); setCsvMapping({}); }} className="flex-1 bg-slate-700 hover:bg-slate-600 py-3 rounded-xl font-medium">Cancelar</button>
                                    <button onClick={() => importCSVVideos(document.getElementById('csvChannelId').value)} className="flex-1 gradient-success py-3 rounded-xl font-medium">Importar {csvData.length}</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Channel Detail Modal */}
                    {showChannelDetail && (
                        <div className="fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50 overflow-y-auto">
                            <div className="glass rounded-2xl p-6 w-full max-w-4xl my-8 animate-fadeIn">
                                {(() => {
                                    const channel = showChannelDetail;
                                    const lang = LANGUAGES.find(l => l.code === channel.language);
                                    const channelVideos = videos.filter(v => v.channel_id === channel.id).sort((a, b) => new Date(b.publish_date) - new Date(a.publish_date));
                                    const totalViews = channelVideos.reduce((sum, v) => sum + (v.views || 0), 0);
                                    const avgCTR = channelVideos.length > 0 ? (channelVideos.reduce((sum, v) => sum + (v.ctr || 0), 0) / channelVideos.filter(v => v.ctr).length).toFixed(2) : 0;
                                    const avgNew = channelVideos.length > 0 ? (channelVideos.reduce((sum, v) => sum + (v.new_viewers_percent || 0), 0) / channelVideos.filter(v => v.new_viewers_percent).length).toFixed(1) : 0;
                                    const totalRevenue = channelVideos.reduce((sum, v) => sum + (v.revenue || 0), 0);
                                    const estimatedRevenue = (totalViews / 1000) * (lang?.rpmAvg || 0);
                                    return (
                                        <>
                                            <div className="flex justify-between items-start mb-6">
                                                <div className="flex items-center gap-4">
                                                    {channel.profile_pic ? <img src={channel.profile_pic} alt="" className="w-16 h-16 rounded-2xl" /> : <div className="w-16 h-16 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-3xl">{lang?.flag}</div>}
                                                    <div><h2 className="text-2xl font-bold">{channel.name}</h2><p className="text-gray-400">{lang?.name} â€¢ {channel.niche}</p></div>
                                                </div>
                                                <button onClick={() => setShowChannelDetail(null)} className="p-2 hover:bg-white/10 rounded-lg">{Icons.x}</button>
                                            </div>
                                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                                <div className="bg-white/5 rounded-xl p-4 text-center"><p className="text-3xl font-bold">{channelVideos.length}</p><p className="text-xs text-gray-400">VÃ­deos</p></div>
                                                <div className="bg-white/5 rounded-xl p-4 text-center"><p className="text-3xl font-bold">{totalViews.toLocaleString()}</p><p className="text-xs text-gray-400">Views</p></div>
                                                <div className="bg-white/5 rounded-xl p-4 text-center"><p className={`text-3xl font-bold ${parseFloat(avgCTR) >= 6 ? 'text-green-400' : 'text-yellow-400'}`}>{avgCTR}%</p><p className="text-xs text-gray-400">CTR</p></div>
                                                <div className="bg-white/5 rounded-xl p-4 text-center"><p className={`text-3xl font-bold ${parseFloat(avgNew) >= 50 ? 'text-green-400' : 'text-yellow-400'}`}>{avgNew}%</p><p className="text-xs text-gray-400">Novos</p></div>
                                            </div>
                                            <div className="bg-white/5 rounded-xl p-4 mb-6"><div className="flex justify-between"><span className="text-gray-400">Revenue</span><span className="text-emerald-400 font-bold text-xl">{totalRevenue > 0 ? `$${totalRevenue.toFixed(2)}` : `~$${estimatedRevenue.toFixed(2)}`}</span></div></div>
                                            <h4 className="font-semibold mb-3">ğŸ“‹ Ãšltimos VÃ­deos</h4>
                                            <div className="bg-white/5 rounded-xl overflow-hidden max-h-64 overflow-y-auto">
                                                <table className="w-full text-sm">
                                                    <thead className="bg-white/5 sticky top-0"><tr><th className="text-left p-3">TÃ­tulo</th><th className="text-right p-3">Views</th><th className="text-right p-3">CTR</th><th className="text-center p-3">Score</th></tr></thead>
                                                    <tbody>
                                                        {channelVideos.slice(0, 10).map(v => { const perfTag = getPerformanceTag(v.performance_score || 50); return (
                                                            <tr key={v.id} className="border-t border-white/5"><td className="p-3 truncate max-w-[200px]">{v.title}</td><td className="p-3 text-right">{(v.views || 0).toLocaleString()}</td><td className="p-3 text-right">{v.ctr}%</td><td className="p-3 text-center"><span className={`text-xs px-2 py-0.5 rounded-full ${perfTag.class}`}>{perfTag.label}</span></td></tr>
                                                        ); })}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </>
                                    );
                                })()}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
